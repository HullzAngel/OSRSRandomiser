<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OSRS Gear Randomizer</title>
<style>
  body {
    font-family: sans-serif;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 50px;
    background-color: #373737;
    margin: 0; /* remove default margin for full-page background */
  }

  /* Background image */
  #background {
    position: fixed;      /* stays behind content */
    top: 0px;
    left: 0px;
    width: 200px;
    height: 190px;
    background-image: url('custom_images/background.png');
    background-repeat: no-repeat;
    background-size: contain;      /* change to 'contain' or % to scale */
    background-position: center; /* adjust X/Y as needed */
    z-index: -1;                 /* behind everything */
  }

  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 19px;
  }
  .row1 {
    display: flex;
    gap: 15px;
  }
  .row2 {
    display: flex;
    gap: 23px;
  }
  .row3 {
    display: flex;
    gap: 53px;
  }
  .row4 {
    display: flex;
    gap: 15px;
  }
  .row5 {
    display: flex;
    gap: 53px;
  }
  button.slot-btn {
    width: 60px;
    height: 60px;
    background-color: #dddddd00;
    border: 0px #99999900;
    border-radius: 0px;
    cursor: pointer;
    padding: 0;
  }
  button.slot-btn img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
  .summary {
    margin-top: 20px;
    margin-left: 25%;
    text-align: left;
    font-size: 16px;
    line-height: 1;
    width: 500px;
  }
  .summary-line {
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .slot-title {
    font-weight: bold;
    display: inline-block;
    width: 70px;
  }
  .item-name {
    display: inline-block;
  }
  #spinCounter {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 20px;
    text-align: center;
  }
</style>
</head>
<body>

<h2 id="spinCounter">Total Spins: 0</h2> <!-- NEW -->

<!-- Background -->
<div class="container-wrapper" style="position: relative;">
  <div id="background" 
       style="position: absolute; 
              top: -9px; 
              left: 60px; 
              width: 380px; 
              height: 400px; 
              background-image: url('custom_images/background.png'); 
              background-size: cover; 
              z-index: -1;">
  </div>

  <div class="container">
    <div class="row1" id="row1"></div>
    <div class="row2" id="row2"></div>
    <div class="row3" id="row3"></div>
    <div class="row4" id="row4"></div>
    <div class="row5" id="row5"></div>
  </div>

  <div class="summary" id="summary">
    <p class="summary-line"><span class="slot-title">Head:</span><span class="item-name"></span></p>
    <p class="summary-line"><span class="slot-title">Cape:</span><span class="item-name"></span></p>
    <p class="summary-line"><span class="slot-title">Amulet:</span><span class="item-name"></span></p>
    <p class="summary-line"><span class="slot-title">Ammo:</span><span class="item-name"></span></p>
    <p class="summary-line"><span class="slot-title">Weapon:</span><span class="item-name"></span></p>
    <p class="summary-line"><span class="slot-title">Body:</span><span class="item-name"></span></p>
    <p class="summary-line"><span class="slot-title">Shield:</span><span class="item-name"></span></p>
    <p class="summary-line"><span class="slot-title">Legs:</span><span class="item-name"></span></p>
    <p class="summary-line"><span class="slot-title">Gloves:</span><span class="item-name"></span></p>
    <p class="summary-line"><span class="slot-title">Boots:</span><span class="item-name"></span></p>
    <p class="summary-line"><span class="slot-title">Ring:</span><span class="item-name"></span></p>
  </div>
</div>



<script>
// Layout configuration
const layout = [
  ["Head_slot_table"],              
  ["Cape_slot_table","Amulet_slot_table","Ammo_slot_table"], 
  ["Weapon_slot_table","Body_slot_table","Shield_slot_table"], 
  ["Legs_slot_table"],              
  ["Gloves_slot_table","Boots_slot_table","Ring_slot_table"] 
];

const slotNames = {
  Head_slot_table: "Head",
  Body_slot_table: "Body",
  Legs_slot_table: "Legs",
  Weapon_slot_table: "Weapon",
  Shield_slot_table: "Shield",
  Cape_slot_table: "Cape",
  Gloves_slot_table: "Gloves",
  Boots_slot_table: "Boots",
  Amulet_slot_table: "Amulet",
  Ring_slot_table: "Ring",
  Ammo_slot_table: "Ammo"
};

// Load JSON
let itemsData = {};
fetch('osrs_items_filtered.json')
  .then(res => res.json())
  .then(data => {
    itemsData = data;
    initButtons();
  })
  .catch(err => console.error("Failed to load JSON:", err));

const missingImages = new Set();
let spinCount = 0; // NEW

// Initialize buttons
function initButtons() {
  layout.forEach((rowSlots, rowIndex) => {
    const rowEl = document.getElementById(`row${rowIndex+1}`);
    rowSlots.forEach(slot => {
      const btn = document.createElement("button");
      btn.classList.add("slot-btn");

      const img = document.createElement("img");
      img.src = "custom_images/default.png";
      btn.appendChild(img);

      btn.addEventListener("click", () => {
        spinCount++; // NEW
        document.getElementById("spinCounter").textContent = "Total Spins: " + spinCount; // NEW

        const items = itemsData[slot];
        if (!items || items.length === 0) return;

        const item = items[Math.floor(Math.random() * items.length)];

        const imgPath = "osrs_item_images/" + encodeURIComponent(item.image);

        img.onerror = () => {
          if (!missingImages.has(item.image)) {
            console.warn("Image not found:", item.image);
            missingImages.add(item.image);
          }
          img.src = "custom_images/default.png";
        };
        img.src = imgPath;

        updateSummary(slot, item.name);
      });

      rowEl.appendChild(btn);
    });
  });
}

// Update the summary block
function updateSummary(slot, name) {
  const slotTitle = slotNames[slot];
  const lines = document.querySelectorAll(".summary-line");
  lines.forEach(line => {
    const titleSpan = line.querySelector(".slot-title");
    if (titleSpan.textContent.replace(":", "") === slotTitle) {
      const itemSpan = line.querySelector(".item-name");
      itemSpan.textContent = " " + name;
    }
  });
}
</script>

</body>
</html>
